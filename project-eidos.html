<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Project Eidos</title>
<link rel="icon" type="image/png" href="data:image/png;base64,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">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300;400;500;600&family=Jost:wght@300;400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --renoir-1: #C08B82;
    --renoir-2: #7A9E82;
    --renoir-3: #B8956A;
    --renoir-4: #8B9AAF;
    --renoir-5: #A08BAF;
    --renoir-6: #7A9BAF;
    --renoir-7: #AF8A6E;
    --renoir-8: #8DAF85;
    --renoir-9: #B08A9A;
  }

  [data-theme="dark"] {
    --bg: #18151200;
    --bg-solid: #181512;
    --surface: #221E1A;
    --surface-2: #2C2722;
    --border: #3A342E;
    --text-primary: #EDE5DC;
    --text-secondary: #9A9088;
    --text-muted: #6A6058;
    --bar-track: #2C2722;
    --shadow: rgba(0,0,0,0.4);
    --grain-opacity: 0.04;
  }

  [data-theme="light"] {
    --bg: #F7F2EC00;
    --bg-solid: #F7F2EC;
    --surface: #EDE6DC;
    --surface-2: #E4DDD2;
    --border: #CFC8BE;
    --text-primary: #2A2520;
    --text-secondary: #6A6058;
    --text-muted: #9A9088;
    --bar-track: #D8D0C5;
    --shadow: rgba(0,0,0,0.12);
    --grain-opacity: 0.03;
  }

  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  /* Responsive base: exact sizes at 13" (~1440px), scales up on TV */
  html {
    font-size: clamp(16px, 1.11vw, 44px);
  }

  body {
    font-family: 'Jost', sans-serif;
    font-weight: 300;
    background-color: var(--bg-solid);
    color: var(--text-primary);
    min-height: 100vh;
    padding: 2.5rem 2rem;
    position: relative;
    overflow-x: hidden;
    transition: background-color 0.4s ease, color 0.4s ease;
  }

  /* Grain texture overlay */
  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='1'/%3E%3C/svg%3E");
    opacity: var(--grain-opacity);
    pointer-events: none;
    z-index: 100;
  }

  /* Header */
  header {
    display: flex;
    align-items: flex-end;
    justify-content: space-between;
    margin-bottom: 3rem;
    padding-bottom: 1.5rem;
    border-bottom: 1px solid var(--border);
  }

  .header-left h1 {
    font-family: 'Cormorant Garamond', serif;
    font-weight: 300;
    font-size: 2.9rem;
    letter-spacing: -0.02em;
    line-height: 1;
    color: var(--text-primary);
  }

  .header-left p {
    font-size: 0.78rem;
    letter-spacing: 0.14em;
    text-transform: uppercase;
    color: var(--text-muted);
    margin-top: 0.4rem;
  }

  .header-actions {
    display: flex;
    align-items: center;
    gap: 1rem;
  }

  /* Theme toggle */
  .theme-toggle {
    width: 52px;
    height: 28px;
    background: var(--surface-2);
    border: 1px solid var(--border);
    border-radius: 14px;
    cursor: pointer;
    position: relative;
    transition: background 0.3s;
  }

  .theme-toggle::after {
    content: '';
    position: absolute;
    top: 3px;
    left: 3px;
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background: var(--text-secondary);
    transition: transform 0.3s ease, background 0.3s;
  }

  [data-theme="light"] .theme-toggle::after {
    transform: translateX(24px);
    background: var(--renoir-3);
  }

  .theme-label {
    font-size: 0.75rem;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: var(--text-muted);
  }

  /* Add project button */
  .btn-add {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.6rem 1.2rem;
    background: transparent;
    border: 1px solid var(--border);
    border-radius: 6px;
    color: var(--text-secondary);
    font-family: 'Jost', sans-serif;
    font-size: 0.78rem;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    cursor: pointer;
    transition: all 0.2s;
  }

  .btn-add:hover {
    border-color: var(--text-secondary);
    color: var(--text-primary);
    background: var(--surface);
  }

  .btn-add span { font-size: 1.1rem; line-height: 1; }

  /* Projects list */
  #projects-list {
    display: flex;
    flex-direction: column;
    gap: 0;
  }

  /* Project row */
  .project-row {
    display: grid;
    grid-template-columns: 200px 1fr;
    align-items: start;
    gap: 1.5rem;
    padding: 1.1rem 0;
    border-bottom: 1px solid var(--border);
    position: relative;
    transition: opacity 0.2s;
    cursor: default;
  }

  .project-row.drag-over {
    border-top: 2px solid var(--renoir-3);
  }

  .project-row.dragging {
    opacity: 0.4;
  }

  /* Project name section */
  .project-name-col {
    display: flex;
    flex-direction: column;
    gap: 0.9rem;
    cursor: grab;
    user-select: none;
    padding-right: 1rem;
    padding-top: 0.35rem;
  }

  .project-name-col:active { cursor: grabbing; }

  .drag-hint {
    display: flex;
    align-items: center;
    gap: 0.7rem;
  }

  .drag-dots {
    display: flex;
    flex-direction: column;
    gap: 3px;
    opacity: 0;
    transition: opacity 0.2s;
  }

  .project-row:hover .drag-dots { opacity: 1; }

  .drag-dots span {
    display: block;
    width: 14px;
    height: 1px;
    background: var(--text-muted);
  }

  .proj-name {
    font-family: 'Cormorant Garamond', serif;
    font-size: 1.1rem;
    font-weight: 500;
    color: var(--text-primary);
    line-height: 1.2;
  }

  .proj-goal {
    font-size: 0.7rem;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    color: var(--text-muted);
    line-height: 1.3;
  }

  /* Bar section */
  .bar-col {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  /* Bar track */
  .bar-track {
    position: relative;
    height: 1.8rem;
    background: var(--bar-track);
    border-radius: 4px;
    overflow: visible;
    cursor: pointer;
  }

  .bar-track:hover .bar-fill {
    filter: brightness(1.1);
  }

  .bar-fill {
    position: absolute;
    left: 0;
    top: 0;
    height: 100%;
    border-radius: 4px;
    transition: width 0.8s cubic-bezier(0.23, 1, 0.32, 1);
    min-width: 4px;
  }

  /* Pulse animation on update */
  @keyframes pulse-glow {
    0% { box-shadow: 0 0 0 0 currentColor; }
    50% { box-shadow: 0 0 16px 4px currentColor; }
    100% { box-shadow: 0 0 0 0 currentColor; }
  }

  .bar-fill.just-updated {
    animation: pulse-glow 1.2s ease-out;
  }

  /* Milestone tip label */
  .milestone-tip {
    position: absolute;
    top: -26px;
    transform: translateX(-50%);
    font-size: 0.65rem;
    letter-spacing: 0.05em;
    white-space: nowrap;
    color: var(--text-secondary);
    pointer-events: none;
    transition: left 0.8s cubic-bezier(0.23, 1, 0.32, 1);
    max-width: 180px;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  /* Percent label inside/outside bar */
  .bar-pct {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    font-size: 0.75rem;
    pointer-events: none;
    white-space: nowrap;
  }
  .bar-pct.inside {
    right: 8px;
    font-weight: 500;
    color: rgba(255,255,255,0.9);
  }
  .bar-pct.outside {
    color: var(--text-secondary);
  }

  /* Bar + goal wrapper */
  .bar-with-goal {
    display: flex;
    flex-direction: column;
    gap: 0.4rem;
    width: 100%;
  }

  .bar-with-goal .bar-track {
    width: 100%;
  }

  /* Goal marker */
  .goal-label {
    font-size: 0.8rem;
    letter-spacing: 0.04em;
    color: var(--text-secondary);
    text-align: right;
    white-space: normal;
    line-height: 1.3;
    flex-shrink: 0;
    max-width: 40%;
  }

  /* Progress meta line */
  .bar-meta {
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    gap: 1rem;
  }

  .bar-meta-right {
    display: flex;
    flex-direction: column;
    align-items: flex-end;
    gap: 0.25rem;
    flex-shrink: 0;
    max-width: 40%;
  }

  .bar-meta-left {
    display: flex;
    align-items: center;
    gap: 0.8rem;
    flex: 1;
    min-width: 0;
  }

  .latest-milestone {
    font-size: 0.8rem;
    color: var(--text-secondary);
    letter-spacing: 0.03em;
  }

  .latest-milestone strong {
    font-weight: 400;
  }

  .update-btn {
    font-family: 'Jost', sans-serif;
    font-size: 0.55rem;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: var(--text-muted);
    background: none;
    border: none;
    cursor: pointer;
    padding: 0.2rem 0.5rem;
    border-radius: 3px;
    transition: all 0.2s;
  }

  .update-btn:hover {
    color: var(--text-primary);
    background: var(--surface);
  }

  /* Milestone history tooltip */
  .history-tooltip {
    position: absolute;
    left: 202px;
    top: calc(100% + 4px);
    background: var(--surface-2);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 0.8rem 1rem;
    z-index: 50;
    min-width: 280px;
    max-width: 400px;
    box-shadow: 0 8px 24px var(--shadow);
    display: none;
  }

  .project-row:hover .history-tooltip {
    display: block;
  }

  .history-tooltip h4 {
    font-family: 'Cormorant Garamond', serif;
    font-size: 0.85rem;
    font-weight: 500;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    color: var(--text-muted);
    margin-bottom: 0.6rem;
  }

  .history-item {
    display: flex;
    align-items: baseline;
    gap: 0.6rem;
    padding: 0.25rem 0;
    border-bottom: 1px solid var(--border);
  }

  .history-item:last-child { border-bottom: none; }

  .history-pct {
    font-size: 0.72rem;
    font-weight: 500;
    color: var(--text-muted);
    min-width: 32px;
  }

  .history-label {
    font-size: 0.78rem;
    color: var(--text-secondary);
    line-height: 1.3;
  }

  /* Empty state */
  .empty-state {
    text-align: center;
    padding: 5rem 2rem;
    color: var(--text-muted);
  }

  .empty-state p {
    font-family: 'Cormorant Garamond', serif;
    font-size: 1.4rem;
    font-weight: 300;
    margin-bottom: 0.5rem;
  }

  .empty-state small {
    font-size: 0.75rem;
    letter-spacing: 0.1em;
    text-transform: uppercase;
  }

  /* Modal */
  .modal-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.5);
    backdrop-filter: blur(4px);
    z-index: 200;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.25s;
  }

  .modal-overlay.open {
    opacity: 1;
    pointer-events: all;
  }

  .modal {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 2rem;
    width: 420px;
    max-width: calc(100vw - 2rem);
    box-shadow: 0 24px 60px var(--shadow);
    transform: translateY(12px);
    transition: transform 0.25s ease;
  }

  .modal-overlay.open .modal {
    transform: translateY(0);
  }

  .modal h2 {
    font-family: 'Cormorant Garamond', serif;
    font-size: 1.6rem;
    font-weight: 400;
    margin-bottom: 1.5rem;
    color: var(--text-primary);
  }

  .form-group {
    margin-bottom: 1.2rem;
  }

  .form-group label {
    display: block;
    font-size: 0.7rem;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: var(--text-muted);
    margin-bottom: 0.5rem;
  }

  .form-group input {
    width: 100%;
    padding: 0.7rem 0.9rem;
    background: var(--surface-2);
    border: 1px solid var(--border);
    border-radius: 6px;
    color: var(--text-primary);
    font-family: 'Jost', sans-serif;
    font-size: 0.9rem;
    font-weight: 300;
    outline: none;
    transition: border-color 0.2s;
  }

  .form-group input:focus {
    border-color: var(--text-secondary);
  }

  .form-group input::placeholder {
    color: var(--text-muted);
  }

  .modal-actions {
    display: flex;
    gap: 0.8rem;
    margin-top: 1.8rem;
    justify-content: flex-end;
  }

  .btn-cancel {
    padding: 0.6rem 1.2rem;
    background: transparent;
    border: 1px solid var(--border);
    border-radius: 6px;
    color: var(--text-muted);
    font-family: 'Jost', sans-serif;
    font-size: 0.82rem;
    cursor: pointer;
    transition: all 0.2s;
  }

  .btn-cancel:hover { color: var(--text-primary); }

  .btn-confirm {
    padding: 0.6rem 1.4rem;
    background: var(--surface-2);
    border: 1px solid var(--border);
    border-radius: 6px;
    color: var(--text-primary);
    font-family: 'Jost', sans-serif;
    font-size: 0.82rem;
    letter-spacing: 0.05em;
    cursor: pointer;
    transition: all 0.2s;
  }

  .btn-confirm:hover {
    border-color: var(--text-secondary);
    background: var(--border);
  }

  /* name-click area: + and project name together trigger log progress */
  .name-click {
    cursor: pointer;
  }

  .name-click:hover .proj-name {
    color: var(--text-secondary);
  }

  /* + visual cue before project name */
  .add-progress-btn {
    color: var(--text-muted);
    font-size: 1rem;
    line-height: 1;
    flex-shrink: 0;
    transition: color 0.2s;
    pointer-events: none;
  }

  .name-click:hover .add-progress-btn { color: var(--text-primary); }

  /* Edit/delete shown below project name on hover */
  .name-actions {
    display: flex;
    gap: 0.5rem;
    opacity: 0;
    transition: opacity 0.2s;
    padding-left: 1.4rem;
  }

  .project-row:hover .name-actions { opacity: 1; }

  .delete-btn, .edit-btn {
    background: none;
    border: none;
    color: var(--text-muted);
    cursor: pointer;
    transition: color 0.2s;
    font-size: 0.72rem;
    padding: 0;
    line-height: 1;
    letter-spacing: 0.05em;
    font-family: 'Jost', sans-serif;
  }

  .edit-btn:hover { color: var(--text-primary); }
  .delete-btn:hover { color: #C08B82; }

  /* Scrollbar */
  ::-webkit-scrollbar { width: 4px; }
  ::-webkit-scrollbar-track { background: transparent; }
  ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 2px; }


</style>
</head>
<body>

<header>
  <div class="header-left">
    <h1>Project Eidos</h1>
    <p>All projects at a glance</p>
  </div>
  <div class="header-actions">
    <span class="theme-label" id="theme-label">Dark</span>
    <button class="theme-toggle" onclick="toggleTheme()" aria-label="Toggle theme"></button>
    <button class="btn-add" onclick="openAddModal()">
      <span>+</span> New Project
    </button>
  </div>
</header>

<div id="projects-list"></div>

<div id="empty-state" class="empty-state" style="display:none">
  <p>No projects yet.</p>
  <small>Add your first project above</small>
</div>

<!-- Add Project Modal -->
<div class="modal-overlay" id="add-modal">
  <div class="modal">
    <h2>New Project</h2>
    <div class="form-group">
      <label>Project Name</label>
      <input type="text" id="new-name" placeholder="e.g. Botanical Illustrations" autocomplete="off">
    </div>
    <div class="form-group">
      <label>Final Goal</label>
      <input type="text" id="new-goal" placeholder="e.g. Publish 40-page zine" autocomplete="off">
    </div>
    <div class="modal-actions">
      <button class="btn-cancel" onclick="closeModals()">Cancel</button>
      <button class="btn-confirm" onclick="addProject()">Add Project</button>
    </div>
  </div>
</div>

<!-- Edit Project Modal -->
<div class="modal-overlay" id="edit-modal">
  <div class="modal">
    <h2>Edit Project</h2>
    <div class="form-group">
      <label>Project Name</label>
      <input type="text" id="edit-name" autocomplete="off">
    </div>
    <div class="form-group">
      <label>Final Goal</label>
      <input type="text" id="edit-goal" autocomplete="off">
    </div>
    <div class="modal-actions">
      <button class="btn-cancel" onclick="closeModals()">Cancel</button>
      <button class="btn-confirm" onclick="saveEdit()">Save</button>
    </div>
  </div>
</div>
<div class="modal-overlay" id="update-modal">
  <div class="modal">
    <h2 id="update-modal-title">Log Progress</h2>
    <div class="form-group">
      <label>What did you complete?</label>
      <input type="text" id="update-label" placeholder="e.g. Received first draft of the deck" autocomplete="off">
    </div>
    <div class="form-group">
      <label>New progress % (0–100)</label>
      <input type="number" id="update-pct" placeholder="e.g. 35" min="0" max="100" autocomplete="off">
    </div>
    <div class="modal-actions">
      <button class="btn-cancel" onclick="closeModals()">Cancel</button>
      <button class="btn-confirm" onclick="saveUpdate()">Log It</button>
    </div>
  </div>
</div>

<script>
// ─── RENOIR PALETTE ──────────────────────────────────────────────────────────
const COLORS_DARK = [
  '#C08B82', '#7A9E82', '#B8956A', '#8B9AAF',
  '#A08BAF', '#7A9BAF', '#AF8A6E', '#8DAF85', '#B08A9A',
];
// Same hues, significantly deeper for light bg
const COLORS_LIGHT = [
  '#8B4A40', '#3D6E48', '#8A5A28', '#3D5270',
  '#60406E', '#2E5E70', '#7A4E2A', '#3D6E45', '#70405A',
];

function COLORS() {
  return document.documentElement.getAttribute('data-theme') === 'light'
    ? COLORS_LIGHT : COLORS_DARK;
}

// ─── STATE ───────────────────────────────────────────────────────────────────
let projects = [];
let currentUpdateId = null;
let dragSrcIdx = null;

function save() {
  localStorage.setItem('project_eidos_v1', JSON.stringify(projects));
}

function load() {
  const raw = localStorage.getItem('project_eidos_v1');
  if (raw) {
    try { projects = JSON.parse(raw); } catch(e) { projects = []; }
  }
  // Legacy migration
  const old = localStorage.getItem('project_eidos_legacy');
  if (old && !raw) {
    try { projects = JSON.parse(old); } catch(e) {}
  }
}

function newId() {
  return Date.now().toString(36) + Math.random().toString(36).slice(2);
}

function pickColor(idx) {
  return COLORS()[idx % COLORS().length];
}

// ─── RENDER ──────────────────────────────────────────────────────────────────
function render() {
  const list = document.getElementById('projects-list');
  const empty = document.getElementById('empty-state');
  list.innerHTML = '';

  if (projects.length === 0) {
    empty.style.display = 'block';
    return;
  }
  empty.style.display = 'none';

  projects.forEach((p, idx) => {
    const color = pickColor(idx);
    const pct = p.progress || 0;
    const milestones = p.milestones || [];
    const latest = milestones[milestones.length - 1] || null;

    const row = document.createElement('div');
    row.className = 'project-row';
    row.dataset.id = p.id;
    row.dataset.idx = idx;

    // Milestone history HTML
    let historyHTML = '';
    if (milestones.length > 0) {
      historyHTML = `
        <div class="history-tooltip">
          <h4>Milestone History</h4>
          ${milestones.map(m => `
            <div class="history-item">
              <span class="history-pct">${m.pct}%</span>
              <span class="history-label">${escHtml(m.label)}</span>
            </div>
          `).join('')}
        </div>`;
    }

    row.innerHTML = `
      <div class="project-name-col">
        <div class="drag-hint name-click" draggable="true" data-id="${p.id}" title="Log progress">
          <div class="drag-dots"><span></span><span></span><span></span></div>
          <span class="proj-name">${escHtml(p.name)}</span>
        </div>
        <div class="name-actions">
          <button class="edit-btn" data-id="${p.id}">✎ edit</button>
          <button class="delete-btn" data-id="${p.id}">✕ delete</button>
        </div>
      </div>
      <div class="bar-col">
        <div class="bar-track">
          <div class="bar-fill" id="fill-${p.id}"
            style="width:${pct}%; background:${color};">
            ${pct > 12 ? `<span class="bar-pct inside">${pct}%</span>` : ''}
          </div>
          ${pct <= 12 ? `<span class="bar-pct outside" style="left:calc(${pct}% + 8px)">${pct}%</span>` : ''}
        </div>
        <div class="bar-meta">
          <span class="latest-milestone">
            ${latest
              ? `<strong>${pct}%</strong> — ${escHtml(latest.label)}`
              : '<span style="opacity:0.5">No progress logged yet</span>'}
          </span>
          <span class="goal-label">${escHtml(p.goal)}</span>
        </div>
      </div>
      ${historyHTML}
    `;

    // Drag events on the name/drag-hint only
    const nameCol = row.querySelector('.drag-hint');
    nameCol.addEventListener('dragstart', e => {
      dragSrcIdx = idx;
      row.classList.add('dragging');
      e.dataTransfer.effectAllowed = 'move';
    });
    nameCol.addEventListener('dragend', () => {
      row.classList.remove('dragging');
      document.querySelectorAll('.project-row').forEach(r => r.classList.remove('drag-over'));
    });
    row.addEventListener('dragover', e => {
      e.preventDefault();
      document.querySelectorAll('.project-row').forEach(r => r.classList.remove('drag-over'));
      if (idx !== dragSrcIdx) row.classList.add('drag-over');
    });
    row.addEventListener('drop', e => {
      e.preventDefault();
      if (dragSrcIdx !== null && dragSrcIdx !== idx) {
        const moved = projects.splice(dragSrcIdx, 1)[0];
        projects.splice(idx, 0, moved);
        save();
        render();
      }
    });

    // Bar click to log progress
    row.querySelector('.bar-track').addEventListener('click', e => {
      e.stopPropagation();
      openUpdateModal(p.id, p.name);
    });

    // name click to log progress
    row.querySelector('.name-click').addEventListener('click', e => {
      e.stopPropagation();
      openUpdateModal(p.id, p.name);
    });

    // Edit button
    row.querySelector('.edit-btn').addEventListener('click', e => {
      e.stopPropagation();
      openEditModal(p.id);
    });
    row.querySelector('.edit-btn').addEventListener('mousedown', e => e.stopPropagation());

    // Delete button - two step to avoid browser confirm() blocking
    const deleteBtn = row.querySelector('.delete-btn');
    deleteBtn.addEventListener('mousedown', e => e.stopPropagation());
    deleteBtn.addEventListener('click', e => {
      e.stopPropagation();
      if (deleteBtn.dataset.confirming === 'true') {
        projects = projects.filter(x => x.id !== p.id);
        save();
        render();
      } else {
        deleteBtn.dataset.confirming = 'true';
        deleteBtn.textContent = '✕ sure?';
        deleteBtn.style.color = '#C08B82';
        setTimeout(() => {
          if (deleteBtn.dataset.confirming) {
            deleteBtn.dataset.confirming = '';
            deleteBtn.textContent = '✕ delete';
            deleteBtn.style.color = '';
          }
        }, 2500);
      }
    });

    list.appendChild(row);
  });
}

function escHtml(str) {
  return String(str)
    .replace(/&/g,'&amp;').replace(/</g,'&lt;')
    .replace(/>/g,'&gt;').replace(/"/g,'&quot;');
}

// ─── MODALS ──────────────────────────────────────────────────────────────────
function openAddModal() {
  document.getElementById('new-name').value = '';
  document.getElementById('new-goal').value = '';
  document.getElementById('add-modal').classList.add('open');
  setTimeout(() => document.getElementById('new-name').focus(), 200);
}

function openEditModal(id) {
  const p = projects.find(x => x.id === id);
  if (!p) return;
  currentUpdateId = id;
  document.getElementById('edit-name').value = p.name;
  document.getElementById('edit-goal').value = p.goal;
  document.getElementById('edit-modal').classList.add('open');
  setTimeout(() => document.getElementById('edit-name').focus(), 200);
}

function saveEdit() {
  const name = document.getElementById('edit-name').value.trim();
  const goal = document.getElementById('edit-goal').value.trim();
  if (!name || !goal) { alert('Please fill in both fields.'); return; }
  const p = projects.find(x => x.id === currentUpdateId);
  if (!p) return;
  p.name = name;
  p.goal = goal;
  save();
  closeModals();
  render();
}


function openUpdateModal(id, name) {
  currentUpdateId = id;
  const p = projects.find(x => x.id === id);
  document.getElementById('update-modal-title').textContent = `Log — ${name}`;
  document.getElementById('update-label').value = '';
  document.getElementById('update-pct').value = p ? (p.progress || 0) : 0;
  document.getElementById('update-modal').classList.add('open');
  setTimeout(() => document.getElementById('update-label').focus(), 200);
}

function closeModals() {
  document.querySelectorAll('.modal-overlay').forEach(m => m.classList.remove('open'));
  currentUpdateId = null;
}

// ─── ACTIONS ─────────────────────────────────────────────────────────────────
function addProject() {
  const name = document.getElementById('new-name').value.trim();
  const goal = document.getElementById('new-goal').value.trim();
  if (!name || !goal) {
    alert('Please fill in both fields.');
    return;
  }
  projects.push({ id: newId(), name, goal, progress: 0, milestones: [] });
  save();
  closeModals();
  render();
}

function saveUpdate() {
  const label = document.getElementById('update-label').value.trim();
  const pctRaw = document.getElementById('update-pct').value;
  const pct = Math.min(100, Math.max(0, parseInt(pctRaw) || 0));
  if (!label) { alert('Please describe what you completed.'); return; }
  if (pctRaw === '') { alert('Please enter a progress %.'); return; }

  const p = projects.find(x => x.id === currentUpdateId);
  if (!p) return;
  p.milestones = p.milestones || [];
  p.milestones.push({ label, pct });
  // Sort milestones by % ascending
  p.milestones.sort((a, b) => a.pct - b.pct);
  // Always keep the highest % as progress
  p.progress = Math.max(...p.milestones.map(m => m.pct));
  save();
  closeModals();
  render();

  // Trigger pulse after render
  requestAnimationFrame(() => {
    const fill = document.getElementById(`fill-${p.id}`);
    if (fill) {
      fill.classList.remove('just-updated');
      void fill.offsetWidth; // reflow
      fill.classList.add('just-updated');
      fill.style.color = pickColor(projects.indexOf(p));
      setTimeout(() => fill.classList.remove('just-updated'), 1300);
    }
  });
}

// ─── THEME ───────────────────────────────────────────────────────────────────
function toggleTheme() {
  const html = document.documentElement;
  const isDark = html.getAttribute('data-theme') === 'dark';
  html.setAttribute('data-theme', isDark ? 'light' : 'dark');
  document.getElementById('theme-label').textContent = isDark ? 'Light' : 'Dark';
  localStorage.setItem('project_eidos_theme', isDark ? 'light' : 'dark');
  render();
}

function loadTheme() {
  const t = localStorage.getItem('project_eidos_theme') || 'dark';
  document.documentElement.setAttribute('data-theme', t);
  document.getElementById('theme-label').textContent = t === 'dark' ? 'Dark' : 'Light';
}

// ─── KEYBOARD ────────────────────────────────────────────────────────────────
document.addEventListener('keydown', e => {
  if (e.key === 'Escape') closeModals();
  if (e.key === 'Enter') {
    if (document.getElementById('add-modal').classList.contains('open')) addProject();
    else if (document.getElementById('edit-modal').classList.contains('open')) saveEdit();
    else if (document.getElementById('update-modal').classList.contains('open')) saveUpdate();
  }
});

document.querySelectorAll('.modal-overlay').forEach(overlay => {
  overlay.addEventListener('click', e => {
    if (e.target === overlay) closeModals();
  });
});

// ─── INIT ────────────────────────────────────────────────────────────────────
loadTheme();
load();

// Seed demo projects if empty
if (projects.length === 0) {
  projects = [
    { id: newId(), name: 'Project Alpha', goal: 'Sell 100 units', progress: 35, milestones: [
        { label: 'Prototype finalised', pct: 15 },
        { label: 'First 10 units shipped', pct: 25 },
        { label: 'Received first batch of reviews', pct: 35 },
      ]
    },
    {
      id: newId(),
      name: 'Project Beta',
      goal: 'Tech transfer complete',
      progress: 60,
      milestones: [
        { label: 'IP documentation submitted', pct: 20 },
        { label: 'Partner NDAs signed', pct: 40 },
        { label: 'Received first draft of the deck', pct: 60 },
      ]
    },
    {
      id: newId(),
      name: 'Project Gamma',
      goal: 'Publish 40-page zine',
      progress: 20,
      milestones: [
        { label: 'Mood board complete', pct: 10 },
        { label: 'First 8 illustrations done', pct: 20 },
      ]
    },
  ];
  save();
}

render();
</script>
</body>
</html>
